# SPEC: UI 布局优化

## 概述

两项布局优化：
1. **弹窗变更日志**: 从左侧窄栏移到底部全宽
2. **已完成任务**: 从页面底部移到右侧边栏

---

## Part 1: 变更日志横向布局

### 背景

任务详情弹窗采用左右两栏布局，左栏200px放属性，右栏放内容。变更日志目前在左栏底部，宽度受限导致日志条目难以阅读。

### 目标

将变更日志移到弹窗底部，横向全宽显示，让用户能清晰查看任务的变更历史。

## 布局变化

```
当前:
┌─────────────────────────────────┐
│ 标题栏                           │
├──────────┬──────────────────────┤
│ 属性     │                      │
│ 进度     │      内容区           │
│ 元信息   │                      │
│ 📋日志   │                      │  ← 日志挤在200px里
├──────────┴──────────────────────┤
│ [取消] [保存]                    │
└─────────────────────────────────┘

改后:
┌─────────────────────────────────┐
│ 标题栏                           │
├──────────┬──────────────────────┤
│ 属性     │                      │
│ 进度     │      内容区           │
│ 元信息   │                      │
├──────────┴──────────────────────┤
│ 📋 变更记录 ▼                    │  ← 全宽显示，默认折叠
│ 01-05 10:30  进度更新: 50%→80%  │
│ 01-04 14:22  移动到「本周」      │
├─────────────────────────────────┤
│ [取消] [保存]                    │
└─────────────────────────────────┘
```

## 实现要点

### HTML 结构调整

将 `changelog-section` 从 `task-modal-left` 移到 `task-modal-body` 之后：

```html
<div class="task-modal-body">
    <div class="task-modal-left">...</div>
    <div class="task-modal-right">...</div>
</div>
<!-- 变更记录移到这里 -->
<div class="changelog-section" id="modal-changelog-section">
    ...
</div>
<div class="task-modal-footer">...</div>
```

### CSS 样式更新

```css
.changelog-section {
    padding: 12px 24px;
    border-top: 1px solid rgba(0, 0, 0, 0.06);
    /* 全宽，不再受左栏200px限制 */
}

.changelog-list {
    max-height: 120px;  /* 限制高度 */
    overflow-y: auto;
}

.changelog-item {
    display: flex;
    gap: 16px;  /* 增加间距 */
}
```

### 行为规则

- **默认折叠**: 变更记录区域默认收起，点击展开
- **最多显示10条**: 保持现有限制
- **新建模式隐藏**: 创建新任务时不显示变更记录区

## 约束

- 仅修改 `frontend/templates/todo.html`
- 纯 CSS/HTML 调整，无后端改动
- 保持移动端兼容

### 验收标准

1. 日志区域跨越弹窗全宽
2. 单条日志时间和描述在同一行完整显示
3. 默认折叠，点击可展开
4. 折叠/展开动画正常
5. 移动端无布局错乱

---

## Part 2: 已完成任务移到右侧

### 背景

当前"已完成任务"区域在四象限下方，占据页面底部全宽。用户需要滚动才能看到，且与主要工作区域分离。

### 目标

将已完成任务移到页面右侧，作为固定侧边栏，与四象限并排显示。

### 布局变化

```
当前:
┌─────────────────────────────────┐
│ Tabs: Today | Week | Month      │
├───────────────┬─────────────────┤
│ 🔥 重要紧急   │ 🎯 重要不紧急   │
├───────────────┼─────────────────┤
│ 📞 紧急不重要 │ 🎮 不重要不紧急 │
├───────────────┴─────────────────┤
│ ▼ 已完成的任务                   │  ← 底部全宽
│   ☑ 任务A  ☑ 任务B  ...         │
└─────────────────────────────────┘

改后:
┌───────────────────────────┬─────────────┐
│ Tabs: Today | Week | Month│             │
├─────────────┬─────────────┤ ▼ 已完成    │
│ 🔥 重要紧急 │ 🎯 重要不紧急│             │
├─────────────┼─────────────┤ ☑ 任务A     │
│ 📞 紧急     │ 🎮 不紧急   │ ☑ 任务B     │
│             │             │ ☑ 任务C     │
└─────────────┴─────────────┴─────────────┘
                              ↑ 右侧边栏
```

### 实现要点

#### HTML 结构调整

将 `completed-section` 从 `todo-matrix-container` 移出，与之并列：

```html
<div class="todo-main-layout">
    <div class="todo-matrix-container">
        <!-- Tabs + 四象限 -->
    </div>
    <div class="completed-sidebar">
        <!-- 已完成任务，原 completed-section -->
    </div>
</div>
```

#### CSS 样式更新

```css
.todo-main-layout {
    display: flex;
    gap: 16px;
}

.todo-matrix-container {
    flex: 1;
}

.completed-sidebar {
    width: 240px;
    flex-shrink: 0;
    max-height: calc(100vh - 200px);
    overflow-y: auto;
    position: sticky;
    top: 20px;
}
```

### 行为规则

- **默认折叠**: 保持现有折叠行为
- **固定位置**: 右侧栏 sticky 定位，滚动时保持可见
- **响应式**: 窄屏时回退到底部布局

### 移动端处理

屏幕宽度 < 1024px 时，回退到原有底部布局：

```css
@media (max-width: 1024px) {
    .todo-main-layout {
        flex-direction: column;
    }
    .completed-sidebar {
        width: 100%;
        position: static;
    }
}
```

### 验收标准

1. 桌面端：已完成任务显示在右侧边栏
2. 右侧栏宽度固定 ~240px
3. 滚动页面时右侧栏保持可见 (sticky)
4. 折叠/展开功能正常
5. 移动端回退到底部布局

---

## 涉及文件

| 文件 | 改动 |
|------|------|
| `frontend/templates/todo.html` | HTML 结构 + 内联 CSS |
| `assets/css/style.css` | completed-section 样式 |

## 实现顺序

1. Part 2: 已完成任务右侧栏（结构变化大，先做）
2. Part 1: 变更日志横向布局（弹窗内调整）
