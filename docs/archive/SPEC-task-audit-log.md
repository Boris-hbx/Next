# SPEC: ä»»åŠ¡å®¡è®¡æ—¥å¿—

## æ¦‚è¿°

ä¸ºæ¯ä¸ªä»»åŠ¡æ·»åŠ åˆ›å»ºæ—¶é—´æ˜¾ç¤ºå’Œå˜æ›´æ—¥å¿—åŠŸèƒ½ï¼Œè®°å½•ä»»åŠ¡çš„å…³é”®å­—æ®µå˜æ›´å†å²ã€‚

## ç›®æ ‡

1. æ˜¾ç¤ºä»»åŠ¡åˆ›å»ºæ—¶é—´
2. è®°å½•å¹¶æ˜¾ç¤ºä»»åŠ¡å˜æ›´å†å²
3. æ’é™¤æ ‡é¢˜å’Œå†…å®¹çš„å˜æ›´ï¼ˆè¿™äº›æ˜¯å¸¸è§„ç¼–è¾‘ï¼‰

## æ•°æ®ç»“æ„

### ç°æœ‰å­—æ®µ
```json
{
  "id": "abc123",
  "text": "ä»»åŠ¡æ ‡é¢˜",
  "content": "è¯¦ç»†å†…å®¹",
  "tab": "today",
  "quadrant": "important-urgent",
  "progress": 50,
  "completed": false,
  "completed_at": null,
  "assignee": "Boris",
  "due_date": "2026-01-10",
  "tags": ["work"],
  "created_at": "2026-01-04T10:30:00",
  "updated_at": "2026-01-04T14:20:00"
}
```

### æ–°å¢å­—æ®µ
```json
{
  "changelog": [
    {
      "time": "2026-01-04T14:20:00",
      "field": "tab",
      "from": "today",
      "to": "week",
      "label": "æ—¶é—´æ®µ: Today â†’ This Week"
    },
    {
      "time": "2026-01-04T15:00:00",
      "field": "progress",
      "from": 0,
      "to": 50,
      "label": "è¿›åº¦: 0% â†’ 50%"
    }
  ]
}
```

## éœ€è¦è®°å½•çš„å˜æ›´

| å­—æ®µ | æ˜¾ç¤ºåç§° | å€¼è½¬æ¢ |
|------|----------|--------|
| `tab` | æ—¶é—´æ®µ | todayâ†’Today, weekâ†’This Week, monthâ†’Next 30 Days |
| `quadrant` | è±¡é™ | important-urgentâ†’ğŸ”¥é‡è¦ç´§æ€¥, ... |
| `progress` | è¿›åº¦ | æ•°å­— + % |
| `completed` | çŠ¶æ€ | trueâ†’å·²å®Œæˆ, falseâ†’æœªå®Œæˆ |
| `assignee` | ç›¸å…³äºº | ç›´æ¥æ˜¾ç¤º |
| `due_date` | è®¡åˆ’å®Œæˆ | æ—¥æœŸæ ¼å¼åŒ– |
| `tags` | æ ‡ç­¾ | æ•°ç»„è½¬å­—ç¬¦ä¸² |

## ä¸è®°å½•çš„å˜æ›´

- `text` (æ ‡é¢˜) - å¸¸è§„ç¼–è¾‘
- `content` (å†…å®¹) - å¸¸è§„ç¼–è¾‘
- `updated_at` - è‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€è®°å½•

## UI è®¾è®¡

### ä»»åŠ¡è¯¦æƒ…å¡ç‰‡ (Infobox)

**æœªå®Œæˆä»»åŠ¡**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»»åŠ¡æ ‡é¢˜                        [ç¼–è¾‘] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯¦ç»†å†…å®¹...                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%              â”‚
â”‚ ç›¸å…³äºº: Boris                        â”‚
â”‚ è®¡åˆ’å®Œæˆ: 2026-01-10                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è±¡é™: ğŸ”¥ é‡è¦ç´§æ€¥                     â”‚
â”‚ æ—¶é—´æ®µ: Today                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“… åˆ›å»ºäº 2026-01-04 10:30          â”‚
â”‚                                     â”‚
â”‚ [ğŸ“‹ å˜æ›´è®°å½• â–¼]                      â”‚  â† é»˜è®¤æ”¶èµ·
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚¹å‡»å±•å¼€å˜æ›´è®°å½•å**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ...                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“… åˆ›å»ºäº 2026-01-04 10:30          â”‚
â”‚                                     â”‚
â”‚ [ğŸ“‹ å˜æ›´è®°å½• â–²]                      â”‚  â† ç‚¹å‡»æ”¶èµ·
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 01-04 15:00  è¿›åº¦: 50% â†’ 80%    â”‚ â”‚
â”‚ â”‚ 01-04 14:20  æ—¶é—´æ®µ: Todayâ†’Week â”‚ â”‚
â”‚ â”‚ 01-04 12:00  ç›¸å…³äºº: (ç©º)â†’Boris â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å·²å®Œæˆä»»åŠ¡** (ä»"å·²å®Œæˆ"æ¸…å•ç‚¹å‡»)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»»åŠ¡æ ‡é¢˜                     âœ“ å·²å®Œæˆ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯¦ç»†å†…å®¹...                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®Œæˆåº¦: 100%                         â”‚
â”‚ ç›¸å…³äºº: Boris                        â”‚
â”‚ è®¡åˆ’å®Œæˆ: 2026-01-10                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è±¡é™: ğŸ”¥ é‡è¦ç´§æ€¥                     â”‚
â”‚ æ—¶é—´æ®µ: Today                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“… åˆ›å»ºäº 2026-01-04 10:30          â”‚
â”‚ âœ… å®Œæˆäº 2026-01-05 16:45          â”‚
â”‚                                     â”‚
â”‚ [ğŸ“‹ å˜æ›´è®°å½• â–¼]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¸ƒå±€å±‚çº§

```
Infobox
â”œâ”€â”€ æ ‡é¢˜æ  (æ ‡é¢˜ + ç¼–è¾‘/å®ŒæˆçŠ¶æ€)
â”œâ”€â”€ å†…å®¹åŒº (è¯¦ç»†æè¿°)
â”œâ”€â”€ å±æ€§åŒº
â”‚   â”œâ”€â”€ è¿›åº¦æ¡/å®Œæˆåº¦
â”‚   â”œâ”€â”€ ç›¸å…³äºº
â”‚   â””â”€â”€ è®¡åˆ’å®Œæˆæ—¶é—´
â”œâ”€â”€ åˆ†ç±»åŒº                    â† è±¡é™æ”¾è¿™é‡Œ
â”‚   â”œâ”€â”€ è±¡é™
â”‚   â””â”€â”€ æ—¶é—´æ®µ
â”œâ”€â”€ æ—¶é—´ä¿¡æ¯åŒº
â”‚   â”œâ”€â”€ åˆ›å»ºæ—¶é—´
â”‚   â””â”€â”€ å®Œæˆæ—¶é—´ (ä»…å·²å®Œæˆæ˜¾ç¤º)
â””â”€â”€ å˜æ›´è®°å½•åŒº                â† æ”¾åœ¨æœ€åº•éƒ¨
    â””â”€â”€ [å±•å¼€/æ”¶èµ·æŒ‰é’®]
        â””â”€â”€ è®°å½•åˆ—è¡¨ (é»˜è®¤éšè—)
```

### å˜æ›´è®°å½•æŒ‰é’®æ ·å¼

```css
.changelog-toggle {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    background: rgba(0,0,0,0.03);
    border: none;
    border-radius: 6px;
    font-size: 0.8rem;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
}

.changelog-toggle:hover {
    background: rgba(0,0,0,0.06);
    color: var(--text-secondary);
}

.changelog-toggle .icon {
    transition: transform 0.2s;
}

.changelog-toggle.expanded .icon {
    transform: rotate(180deg);
}
```

### äº¤äº’è§„åˆ™

- **é»˜è®¤çŠ¶æ€**: å˜æ›´è®°å½•æ”¶èµ·ï¼Œåªæ˜¾ç¤ºæŒ‰é’®
- **ç‚¹å‡»æŒ‰é’®**: å±•å¼€/æ”¶èµ·å˜æ›´è®°å½•åˆ—è¡¨
- **æœ€å¤šæ˜¾ç¤º**: æœ€è¿‘ 10 æ¡è®°å½•
- **ç©ºè®°å½•**: æ˜¾ç¤º "æš‚æ— å˜æ›´è®°å½•"
- **æ—¶é—´æ ¼å¼**: MM-DD HH:mmï¼ˆå½“å¹´çœç•¥å¹´ä»½ï¼‰

## åç«¯å®ç°

### API å˜æ›´

`PUT /api/todos/<id>` ä¿®æ”¹ï¼š

```python
def update_todo(item_id):
    # ... ç°æœ‰é€»è¾‘ ...

    # éœ€è¦è®°å½•çš„å­—æ®µ
    tracked_fields = {
        'tab': 'æ—¶é—´æ®µ',
        'quadrant': 'è±¡é™',
        'progress': 'è¿›åº¦',
        'completed': 'çŠ¶æ€',
        'assignee': 'ç›¸å…³äºº',
        'due_date': 'è®¡åˆ’å®Œæˆ',
        'tags': 'æ ‡ç­¾'
    }

    changelog = item.get('changelog', [])

    for field, label in tracked_fields.items():
        if field in req_data:
            old_val = item.get(field)
            new_val = req_data[field]
            if old_val != new_val:
                changelog.append({
                    'time': now,
                    'field': field,
                    'from': old_val,
                    'to': new_val,
                    'label': format_change(field, old_val, new_val)
                })

    # é™åˆ¶è®°å½•æ•°é‡ï¼ˆä¿ç•™æœ€è¿‘ 50 æ¡ï¼‰
    if len(changelog) > 50:
        changelog = changelog[-50:]

    item['changelog'] = changelog
```

### å€¼æ ¼å¼åŒ–å‡½æ•°

```python
def format_change(field, old_val, new_val):
    labels = {
        'tab': {'today': 'Today', 'week': 'This Week', 'month': 'Next 30 Days'},
        'quadrant': {
            'important-urgent': 'ğŸ”¥é‡è¦ç´§æ€¥',
            'important-not-urgent': 'ğŸ¯é‡è¦ä¸ç´§æ€¥',
            'not-important-urgent': 'ğŸ“ä¸é‡è¦ç´§æ€¥',
            'not-important-not-urgent': 'ğŸ®ä¸é‡è¦ä¸ç´§æ€¥'
        },
        'completed': {True: 'å·²å®Œæˆ', False: 'æœªå®Œæˆ'}
    }

    def fmt(field, val):
        if val is None or val == '':
            return '(ç©º)'
        if field in labels and val in labels[field]:
            return labels[field][val]
        if field == 'progress':
            return f'{val}%'
        if field == 'tags':
            return ', '.join(val) if val else '(ç©º)'
        return str(val)

    field_names = {
        'tab': 'æ—¶é—´æ®µ', 'quadrant': 'è±¡é™', 'progress': 'è¿›åº¦',
        'completed': 'çŠ¶æ€', 'assignee': 'ç›¸å…³äºº',
        'due_date': 'è®¡åˆ’å®Œæˆ', 'tags': 'æ ‡ç­¾'
    }

    return f"{field_names.get(field, field)}: {fmt(field, old_val)} â†’ {fmt(field, new_val)}"
```

## å‰ç«¯å®ç°

### ä»»åŠ¡è¯¦æƒ…å¡ç‰‡

åœ¨ `todo.html` çš„ `openTaskModal` å‡½æ•°ä¸­æ·»åŠ ï¼š

```javascript
// æ˜¾ç¤ºåˆ›å»ºæ—¶é—´
var createdAt = item.created_at ? formatDateTime(item.created_at) : 'æœªçŸ¥';
document.getElementById('modal-created-at').textContent = 'åˆ›å»ºäº ' + createdAt;

// æ˜¾ç¤ºå˜æ›´è®°å½•
var changelog = item.changelog || [];
var changelogHtml = '';
changelog.slice(-10).reverse().forEach(function(log) {
    changelogHtml += '<div class="changelog-item">' +
        '<span class="changelog-time">' + formatShortTime(log.time) + '</span>' +
        '<span class="changelog-text">' + log.label + '</span>' +
    '</div>';
});
document.getElementById('modal-changelog').innerHTML = changelogHtml || '<div class="changelog-empty">æš‚æ— å˜æ›´è®°å½•</div>';
```

### CSS æ ·å¼

```css
.task-meta-info {
    padding: 12px 16px;
    background: rgba(0,0,0,0.02);
    border-top: 1px solid rgba(0,0,0,0.06);
    font-size: 0.85rem;
    color: var(--text-muted);
}

.changelog-section {
    padding: 12px 16px;
    border-top: 1px solid rgba(0,0,0,0.06);
}

.changelog-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-size: 0.85rem;
    color: var(--text-muted);
}

.changelog-list {
    margin-top: 8px;
    max-height: 200px;
    overflow-y: auto;
}

.changelog-item {
    display: flex;
    gap: 12px;
    padding: 6px 0;
    font-size: 0.8rem;
    border-bottom: 1px dashed rgba(0,0,0,0.06);
}

.changelog-time {
    color: var(--text-muted);
    white-space: nowrap;
    min-width: 80px;
}

.changelog-text {
    color: var(--text-secondary);
}

.changelog-empty {
    color: var(--text-muted);
    font-style: italic;
    padding: 8px 0;
}
```

## è¿ç§»ç­–ç•¥

å¯¹äºç°æœ‰ä»»åŠ¡ï¼š
- `created_at` å·²å­˜åœ¨ï¼Œæ— éœ€è¿ç§»
- `changelog` ä¸ºç©ºæ•°ç»„ï¼Œä»æ­¤åˆ»å¼€å§‹è®°å½•

## å·¥ä½œé‡ä¼°ç®—

| ä»»åŠ¡ | å¤æ‚åº¦ |
|------|--------|
| åç«¯ changelog è®°å½•é€»è¾‘ | ä¸­ |
| å‰ç«¯ UI æ˜¾ç¤º | ä¸­ |
| CSS æ ·å¼ | ä½ |
| æµ‹è¯•éªŒè¯ | ä½ |

## éªŒæ”¶æ ‡å‡†

1. [ ] ä»»åŠ¡è¯¦æƒ…æ˜¾ç¤ºåˆ›å»ºæ—¶é—´
2. [ ] ä¿®æ”¹ tab/quadrant/progress/completed/assignee/due_date/tags æ—¶è‡ªåŠ¨è®°å½•
3. [ ] ä¿®æ”¹ text/content æ—¶ä¸è®°å½•
4. [ ] å˜æ›´è®°å½•æŒ‰æ—¶é—´å€’åºæ˜¾ç¤º
5. [ ] å˜æ›´è®°å½•å¯æŠ˜å /å±•å¼€
6. [ ] æ—§ä»»åŠ¡æ­£å¸¸æ˜¾ç¤ºï¼ˆchangelog ä¸ºç©ºï¼‰
