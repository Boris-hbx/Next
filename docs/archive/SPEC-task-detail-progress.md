# Task Detail & Progress Bar 规范

## 概述

优化待办事项的显示和交互：
1. 任务列表只显示标题（title）
2. 点击任务打开详情弹窗（Info Box）
3. 任务边框下方显示完成度进度条

---

## 一、任务列表显示

### 当前状态
- 任务项显示：拖拽手柄 + 复选框 + 标题 + 操作按钮
- 点击任务已可打开详情卡片

### 新增：进度条下划线

```
┌─────────────────────────────────────┐
│ ⋮⋮  ○  任务标题文字                  │
│        ════════░░░░░░░░░░░░░░░░░░░  │ ← 文字下划线（1.5px）
└─────────────────────────────────────┘
```

**设计理念**：进度条作为标题文字的下划线，不占用额外空间，一眼看长度即知完成度。

#### 样式参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 位置 | 文字正下方 | 像下划线一样 |
| 高度 | 1.5px | 细线，不抢视觉 |
| 宽度 | 与文字等宽 | 跟随文字长度 |
| 填充色 | #4f46e5 (indigo) | 已完成部分 |
| 背景色 | 透明或极淡灰 | 未完成部分（可选） |
| 显示条件 | progress > 0 | 0% 时不显示 |

#### CSS 实现

```css
.task-text {
    position: relative;
    display: inline-block;
}

/* 进度下划线 */
.task-text::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 1.5px;
    background: rgba(0, 0, 0, 0.1);  /* 底色（可选） */
}

.task-text .progress-underline {
    position: absolute;
    bottom: -2px;
    left: 0;
    height: 1.5px;
    background: #4f46e5;
    transition: width 0.3s ease;
}

/* 或直接用 data 属性 + CSS 变量 */
.task-text[data-progress]::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: var(--progress, 0%);
    height: 1.5px;
    background: #4f46e5;
}
```

#### HTML 实现

```html
<div class="task-text" data-progress="35" style="--progress: 35%">
    任务标题文字
</div>
```

---

## 二、任务详情弹窗（查看/编辑 双模式）

### 设计理念
**同一个弹窗，两种模式**：
- **查看模式**：字段只读，底部按钮 [ 编辑 ]
- **编辑模式**：字段可编辑，底部按钮 [ 取消 ] [ 保存 ]

点击"编辑"切换到编辑模式，点击"取消"返回查看模式或关闭。

### 数据结构扩展

```json
{
    "id": "t001",
    "text": "任务标题",           // 标题（简短）
    "content": "详细描述...",     // 新增：详细内容
    "tab": "today",
    "quadrant": "important-urgent",
    "assignee": "张三",
    "due_date": "2026-01-10",
    "progress": 35,
    "completed": false,
    "created_at": "2026-01-01T09:00:00",
    "updated_at": "2026-01-01T09:00:00"
}
```

### 弹窗布局（通用）

```
┌──────────────────────────────────────────┐
│                                        ✕  │
├──────────────────────────────────────────┤
│  标题                                      │
│  ┌────────────────────────────────────┐  │
│  │ 任务标题文字                        │  │
│  └────────────────────────────────────┘  │
│                                          │
│  详细内容                                  │
│  ┌────────────────────────────────────┐  │
│  │ 详细描述，可多行...                  │  │
│  │ 包含背景、相关人员、注意事项等        │  │
│  │                                    │  │
│  └────────────────────────────────────┘  │
│                                          │
│  ┌─────────────┐  ┌─────────────────┐   │
│  │ 完成度      │  │ 计划完成        │   │
│  │ [====35%==] │  │ [2026-01-10]    │   │
│  └─────────────┘  └─────────────────┘   │
│                                          │
│  ┌─────────────┐  ┌─────────────────┐   │
│  │ 相关人      │  │ 象限            │   │
│  │ [张三    ]  │  │ [🔥 重要紧急 ▼] │   │
│  └─────────────┘  └─────────────────┘   │
│                                          │
├──────────────────────────────────────────┤
│  查看模式:              [ 编辑 ]          │
│  编辑模式:        [ 取消 ]  [ 保存 ]      │
└──────────────────────────────────────────┘
```

### 两种模式对比

| 元素 | 查看模式 | 编辑模式 |
|------|---------|---------|
| 标题 | readonly | 可编辑 |
| 详细内容 | readonly | 可编辑 |
| 完成度 | 禁用滑块 | 可拖拽 |
| 计划完成 | readonly | 可选择 |
| 相关人 | readonly | 可编辑 |
| 象限 | 禁用下拉 | 可选择 |
| 底部按钮 | [ 编辑 ] | [ 取消 ] [ 保存 ] |

### 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| 标题 | input | 单行文本 |
| 详细内容 | textarea | 多行文本，4-6行高度 |
| 完成度 | range slider | 0-100%，拖拽调节 |
| 计划完成 | date | 日期选择器 |
| 相关人 | input | 单行文本 |
| 象限 | select | 四选一下拉 |

### 三种场景统一

| 场景 | 模式 | 按钮 |
|------|------|------|
| 点击任务查看 | 查看模式 | [ 编辑 ] |
| 点击编辑 | 编辑模式 | [ 取消 ] [ 保存 ] |
| 点击新建 | 编辑模式 | [ 取消 ] [ 创建 ] |

### 交互流程

```
【查看】
点击任务 → 打开弹窗（查看模式）→ 点击 [ 编辑 ] → 编辑模式
                                              ↓
                              点击 [ 保存 ] → 保存并关闭
                              点击 [ 取消 ] → 关闭弹窗

【新建】
点击 + 添加任务 → 打开弹窗（编辑模式，字段为空）
                              ↓
                  点击 [ 创建 ] → 创建任务并关闭
                  点击 [ 取消 ] → 关闭弹窗
```

### 新建时的默认值

| 字段 | 默认值 |
|------|--------|
| 标题 | 空 |
| 详细内容 | 空 |
| 完成度 | 0% |
| 计划完成 | 空 |
| 相关人 | 空 |
| 象限 | 当前点击的象限 或 重要紧急 |
| 时间段 | 当前 Tab（Today/Week/Month） |

---

## 四、后端 API 扩展

### PUT /api/todos/<id>

支持更新 `content` 字段：

```json
// Request
{
    "text": "任务标题",
    "content": "详细内容",
    "assignee": "张三",
    "due_date": "2026-01-10",
    "progress": 50
}

// Response
{
    "success": true,
    "item": { ... }
}
```

---

## 五、实现清单

### 前端修改（todo.html）

1. **任务项 HTML** - 文字下划线进度条
   ```javascript
   function createItemHtml(item) {
       var progress = item.progress || 0;
       var progressStyle = progress > 0 ? 'style="--progress:' + progress + '%"' : '';
       return '...' +
           '<div class="task-text" ' + progressStyle + '>' + escapeHtml(item.text) + '</div>' +
       '...';
   }
   ```

2. **Info Box 简化** - 只显示标题和内容
   ```javascript
   document.getElementById('task-card-title').textContent = item.text;
   document.getElementById('task-card-body').textContent = item.content || '';
   ```

3. **编辑弹窗重构** - 全字段编辑
   - 标题（input）
   - 详细内容（textarea）
   - 完成度（range slider）
   - 计划完成（date）
   - 相关人（input）
   - 象限（select）

4. **CSS** - 进度下划线 + 弹窗样式

### 后端修改（app.py）

1. 更新 `PUT /api/todos/<id>` 支持 content 字段

---

## 六、不在范围内

- 进度条动画效果
- 进度自动计算（如子任务）
- 任务评论功能
- 附件上传

---

## 七、验收标准

1. 任务列表：progress > 0 时，底部显示进度条线
2. 点击任务：弹出详情卡片，显示标题、内容、相关人、时间、进度
3. 编辑任务：可修改标题、内容、相关人、计划时间
4. 数据持久化：content 字段正确保存

---

## 审批

请确认以上规范是否符合预期。
